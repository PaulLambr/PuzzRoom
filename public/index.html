<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J Quest - Scene Tester</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="/libs/phaser.js"></script> <!-- Path to your local Phaser file -->
    <script src="/components/inventory.js"></script> <!-- Load inventory functionality -->
    <script src="/scenes/castlebedroom.js"></script> <!-- Load CastleBedroom scene -->
    <script src="/scenes/tower2.js"></script> <!-- Load Tower2 scene -->
    <script src="/scenes/tower.js"></script> <!-- Load Tower scene -->
    <script src="/scenes/hall.js"></script> <!-- Load Hall scene -->
    <script src="/scenes/diningroom.js"></script> <!-- Load DiningRoom scene -->
    <script src="/scenes/hallthrone.js"></script> <!-- Load HallThrone scene -->
    <script src="/scenes/cellar.js"></script>
    <script src="/scenes/castleprairie.js"></script>
    <script src="/components/message.js"></script>
    <script src="/scenes/g1grasslandswamp.js"></script>
    <script src="/scenes/g3grasslandcorn.js"></script>
    <script src="/scenes/shoreriver1.js"></script>
    <script src="/scenes/poke.js"></script>
    <script src="/components/itemhandler.js"></script>
    <script src="/scenes/hutinterior.js"></script>
    <script src="/scenes/grassriver1.js"></script>
    <script src="/scenes/grassrivermount.js"></script>
    <script src="/scenes/caveentrance.js"></script>
    <script src="/scenes/caveinterior.js"></script>
    <script src="/scenes/spellbooks.js"></script>
    <script src="/scenes/hutinterior2.js"></script>
    <script src="/scenes/hutinterior3.js"></script>
    <script src="/scenes/g2grasslandswamp.js"></script>
    <script src="/scenes/swampmaze.js"></script>
    <script src="/scenes/gfcm.js"></script>
    <script src="/scenes/bridge.js"></script>
   

    

    <style>
        body {
            margin: 0;
            padding: 0;
            padding-top: 60px; /* Ensure body starts below the navbar */
        }
    
        #game-container {
            /* You can keep this if additional margin is needed */
            margin-top: 0; /* No extra margin needed here */
        }
    
        canvas {
            display: block;
        }
    
        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            height: 80px; /* Set the height of the navbar */
            background-color: #333; /* Example background color */
            z-index: 1000; /* Keep menu on top of the Phaser game */
        }
    </style>
    
    
</head>
<body>

    <!-- Bootstrap Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">J Quest</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="fileMenu" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            File
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="fileMenu">
                            <li><a class="dropdown-item" href="#" id="saveGame">Save</a></li>
                            <li><a class="dropdown-item" href="#" id="restoreGame">Restore</a></li>
                            <li><a class="dropdown-item" href="#" id="restartGame">Restart</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div id="game-container"></div> <!-- Game container for Phaser -->
    <input type="file" id="fileInput" accept=".json" style="display:none;" />
    <pre id="output"></pre> <!-- This will display the loaded JSON content for debugging -->

    <!-- Bootstrap JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Helper function to get query parameters
            function getQueryParam(param) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(param);
            }

            // Fetch scene from URL parameter 'scene' if available
            const sceneID = getQueryParam('scene') || 'CastleBedroom';  // Default to CastleBedroom if not provided

            // Phaser game configuration
            const config = {
                type: Phaser.AUTO,
                width: 1800,
                height: 1300,
                physics: {
                    default: 'arcade',
                    arcade: {
                        gravity: { y: 0 },
                        debug: true  // Enable debug mode to visualize physics bodies
                    }
                },
                scene: [CastleBedroom, Tower, Tower2, Hall, DiningRoom, HallThrone, Cellar, CastlePrairie, G1grasslandswamp, G3grasslandcorn, ShoreRiver1,
                Poke, HutInterior, Grassriver1, Grassrivermount, CaveEntrance, CaveInterior, Spellbooks, HutInterior2, HutInterior3, G2grasslandswamp,
                Swampmaze, GFCM, Bridge


            ]  // All your scenes
            };

            window.game = new Phaser.Game(config);  // Assign Phaser game to global window

            // Prevent default key actions (arrow keys, spacebar) from interacting with the menu
            window.addEventListener('keydown', function(e) {
                if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].indexOf(e.key) > -1) {
                    e.preventDefault();  // Prevent default behavior for arrow keys and spacebar
                }
            });

            // Start the scene based on the URL sceneID parameter
            window.game.events.on('ready', () => {
                if (window.game.scene.keys[sceneID]) {
                    window.game.scene.start(sceneID);  // Start the scene provided in URL
                    console.log('Starting scene:', sceneID);
                } else {
                    console.error('Scene not found:', sceneID);
                }
            });

            // Save game state to a JSON file
            document.getElementById('saveGame').addEventListener('click', () => {
                const gameState = {};
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    gameState[key] = localStorage.getItem(key);
                }

                const json = JSON.stringify(gameState, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'gameState.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                console.log('Game state saved:', gameState);
            });

            // Restore game from JSON file
            document.getElementById('restoreGame').addEventListener('click', () => {
                document.getElementById('fileInput').click();  // Trigger file input
            });

            document.getElementById('fileInput').addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const fileContent = e.target.result;
                        const gameState = JSON.parse(fileContent);

                        // 1) Clear localStorage
                        localStorage.clear();

                        // 2) Populate localStorage with values from the JSON file
                        Object.keys(gameState).forEach(key => {
                            localStorage.setItem(key, gameState[key]);
                        });

                        console.log('Game state loaded:', gameState);

                        // 3) Start the current scene from the JSON file
                        const currentScene = gameState.currentScene || 'CastleBedroom';
                        if (window.game.scene.keys[currentScene]) {
                            window.game.scene.start(currentScene);
                            console.log('Restoring to scene:', currentScene);
                        } else {
                            console.error('Scene not found:', currentScene);
                        }
                    };

                    reader.readAsText(file);  // Read the file as text
                } else {
                    console.error('No file selected');
                }
            });

            // Restart the game
            document.getElementById('restartGame').addEventListener('click', () => {
                localStorage.clear();
                window.location.reload();  // Reload the page to start the game from the beginning
                console.log('Game restarted');
            });
        });
    </script>
</body>
</html>
